# JSTColorPicker
从 PNG 屏幕截图中选择颜色, 位置和区域 (即图像批注). 该工具使用 [sRGB IEC61966-2.1](https://en.wikipedia.org/wiki/SRGB) 作为其色彩空间.


## 功能特性
- 从 PNG 屏幕截图中标注*坐标及颜色*和*区域*
- 从 PNG 文件的 EXIF 字典中读/写标注器数据
- 直接从 iOS 设备获取屏幕截图 (依赖于 `libimobiledevice`)
- 使用自定义模板复制/导出标注器数据
- 分析并显示不同截图之间的差异


## TODOs
- 从 Android 设备获取屏幕截图


## 使用说明

### 魔术光标
- `⌘↵` / **轻按** (*Force Touch*: **单击**): 将当前*坐标及颜色标注*添加到内容列表.
- `⇧` + **拖动** (*Force Touch*: **按下拖动**): 将当前拖拽*区域标注*添加到内容列表.
- `⌘⌫`: 删除当前*坐标和颜色标注*或包含当前位置的*区域标注*.
- **按住** `⌘`: 暂时切换到*选择箭头*.

### 放大镜
- **轻按** (*Force Touch*: **单击**): 自当前位置放大到下一缩放级别.
- `⇧` + **拖动** (*Force Touch*: **按下拖动**): 放大已拖拽区域, 使之填充整个窗口.
- **按住** `⌘`: 暂时切换到 *魔术光标*.
- **按住** `⌥`: 暂时切换到 *缩小镜*.

### 缩小镜
- **轻按** (*Force Touch*: **单击**): 自当前位置缩小到上一缩放级别.
- **按住** `⌘`: 暂时切换到 *魔术光标*.
- **按住** `⌥`: 暂时切换到 *放大镜*.

### 选择箭头
- **轻按** (*Force Touch*: **单击**) 标注: 选择当前*坐标和颜色标注*或包含当前位置的*区域标注*.
- **拖动** (*Force Touch*: **按下拖动**) 标注: 修改*坐标和颜色标注*到新的位置, 修改*区域标注*的尺寸.
- **按住** `⌘`: 暂时切换到 *魔术光标*.

### 移动工具
- **拖动** (*Force Touch*: **按下拖动**) 视图: 常规鼠标设备的简单拖拽移动操作.
- **按住** `⌘`: 暂时切换到 *魔术光标*.
- **单指划动**: 妙控鼠标的视图移动操作.
- **双指划动**: 妙控板的视图移动操作.
- **双指捏合**: 妙控板放大或缩小视图.
- **双指双击**: 妙控板智能缩放.
- `⌘` + `↑ ↓ ← →`: 将光标移动 1 个像素.
- `⇧⌘` + `↑ ↓ ← →`: 将光标移动 10 个像素.
- `⌃⌘` + `↑ ↓ ← →`: 将光标移动 100 像素.

### 标尺
- **拖动**: 修改*坐标和颜色标注*到新的位置, 修改*区域标注*的尺寸.

### 适合窗口 / 填充窗口
缩放视图到适合/填充窗口的尺寸.

### 标注管理
- 从左侧的标注列表中选择一个或多个项目.
- 右键单击以显示所选项目的菜单:
  - `⌘C`: 使用当前*模板*复制所选项目.
  - `⇧⌘S`: 将所选*区域标注*另存为 PNG 文件.
  - `⇧⌘E`: 使用当前*模板*导出所选项目.
  - `↵`: 视图定位到所选项目.
  - `⌫`: 删除所选项目.
- `0123456789`: 快速输入项目 `ID` 以选择现有项目.

### 导出
- `⌘E`: 使用当前*模板*导出所有项目.
- 点击右下角列表按钮显示导出选项菜单:
  - *重新加载所有模板*: 修改模板文件后, 使用该操作以重载所有*模板*文件, 立即生效.
  - *显示模板...*: 在 Finder 中显示*模板*存放的文件夹.
  - *显示日志...*: 打开*控制台*, 以便显示*模板*执行过程中产生的所有日志以及异常信息.

### 其他
- <code>⌘`</code>: 使用当前*模板*拷贝当前*坐标和颜色标注*到系统剪贴板.


## 菜单快捷键

### JSTColorPicker
- `⌘,` 偏好设置...
- `⌘H` 隐藏 JSTColorPicker
- `⌥⌘H` 隐藏其他窗口
- `⌘Q` 退出 JSTColorPicker

### 文件
- `⌘N` 新建
- `⌘O` 打开...
- `⌘W` 关闭
- `⌘S` 保存...
- `⇧⌘S` 另存为...
- `⇧⌘D` 比较打开的文档

### 编辑
- `⌘Z` 撤销
- `⇧⌘Z` 重做
- `⌫` 删除
- `⌘A` 全选

### 视图
- `⌥⌘T` 显示/隐藏工具栏
- `⌃⌘S` 显示/隐藏侧边栏
- `⌃⌘F` 进入/退出全屏幕
- `⌃⌘G` **切换颜色网格**
- `⌃⌘C` **切换颜色面板**

### 设备
- `⌥⌘S` **截图**

### 窗口
- `⌘M` 最小化
- `⌃⇧⇥` 显示上一个标签页
- `⌃⇥` 显示下一个标签页
- `⇧⌘\` 显示所有标签页

### 帮助
- `⌘?` JSTColorPicker 帮助


## 工具栏快捷键
- `⌃F1` 打开...
- `⌃F2` *魔术光标*
- `⌃F3` *放大镜*
- `⌃F4` *缩小镜*
- `⌃F5` *选择箭头*
- `⌃F6` *移动*
- `⌃F7` 适合窗口
- `⌃F8` 填充窗口


## 自定义模板

JSTColorPicker 使用 [Lua 5.3.4](https://www.lua.org/) 作为其模板引擎.

单击窗口右下方的*导出选项*按钮, 你将能查看并选择全部可用*模板*. 单击 `显示模板...` 将在 Finder 中打开默认*模板*文件夹 `templates`. 模板文件的文件名应以扩展名 `.lua` 结尾. 如果可能, 所选*模板*将应用于所有复制及导出操作.

### 编写自定义模板

*模板*是一个 *Lua* 脚本文件, 它仅返回一个表:
```lua
return {
    uuid = "0C2E7537-45A6-43AD-82A6-35D774414A09",  -- 必填, 唯一的 UUID4 标识符
    name = "Example",  -- 必填, 仅供显示的模板名称
    version = "0.1",  -- 必填, 同一模板的较早版本将被隐藏
    platformVersion = "1.6",  -- 模板所需的最低软件版本
    author = "Lessica",  -- 作者名称
    description = "This is an example of JSTColorPicker export script.",  -- 模板描述
    extension = "lua",  -- 导出时所使用的文件扩展名
    generator = generator,  -- 必填
}
```

`generator` 生成器是一个 Lua 函数, 它将在你复制及导出项目时被执行:
```lua
local generator = function (image, ...)
    --
    local args = {...}
    --
end
```

上述 `image` 是一个 Lua 表, 它代表当前窗口中打开的图像文档:
  - `image.w`: 以像素为单位的图像宽度
  - `image.h`: 以像素为单位的图像高度
  - `image.get_color(x, y)`: 返回该位置颜色的 **argb** 整数值
  - `image.get_image(x, y, w, h)`: 返回以该区域裁切原始图像后, 生成子图像的 PNG 图像数据表示形式

上述 `args` 是一个包含若干表的 Lua 序列, 它包含了所有的*坐标和颜色标注*及*区域标注*信息:
* 如果是*坐标和颜色标注*, 则表中应包含如下字段:
  - `color.id`
  - `color.similarity`
  - `color.x`
  - `color.y`
  - `color.color`: 颜色的 **argb** 整数值
* 如果是*区域标注*, 则表中应包含如下字段:
  - `area.id`
  - `area.similarity`
  - `area.x`
  - `area.y`
  - `area.w`: 以像素为单位的区域宽度
  - `area.h`: 以像素为单位的区域高度

通过检查 `item.w` 字段是否存在即可判断当前表是一个*坐标和颜色标注*还是*区域标注*.

