# JSTColorPicker
从 PNG 屏幕截图 (即图像批注) 中选择颜色，位置和区域。该工具使用 [sRGB IEC61966-2.1](https://en.wikipedia.org/wiki/SRGB) 作为其色彩空间。


## 功能特性
- 从 PNG 屏幕截图中标注*坐标及颜色*和*区域*
- 从 PNG 文件的 EXIF 字典中读/写标注器数据
- 直接从 iOS 设备获取屏幕截图 (你需要额外下载并安装 [设备截图组件](https://82flex.github.io/JSTColorPicker/) 以使用此功能.)
- 使用自定义模板复制/导出标注器数据
- 比对并显示截图之间的差异


## TODOs
- 从 Android 设备获取屏幕截图


## 使用说明

### 魔术光标
- `⌘↵` / **轻按** (*Force Touch*: **单击**): 将当前*坐标及颜色标注*添加到内容列表.
- `⇧` + **拖动** (*Force Touch*: **按下拖动**): 将当前拖拽*区域标注*添加到内容列表.
- `⌘⌫`: 删除当前*坐标和颜色标注*或包含当前位置的*区域标注*.
- **右键轻按** (*Force Touch*: **双指单击**) 标注: 删除当前位置下的*坐标和颜色标注*, 或位于顶层的*区域标注*.
- `⌥` + **右键轻按** (*Force Touch*: **双指单击**) 标注: 显示菜单, 包含当前位置**所有层级下**层叠的*区域标注*, 选择一项以删除标注.
- **按住** `⌃`: 暂时切换到*选择箭头*.

### 选择箭头
- **轻按** (*Force Touch*: **单击**) 标注: 选择当前位置下的*坐标和颜色标注*, 或位于顶层的*区域标注*.
- `⌘` + **轻按** (*Force Touch*: **单击**) 标注: 选择当前位置下的*坐标和颜色标注*, 或位于顶层的*区域标注*, 同时保留之前的选择项.
- `⇧` + **轻按** (*Force Touch*: **单击**) 标注: 选择当前位置下的*坐标和颜色标注*, 或**所有层级下**层叠的*区域标注*, 同时保留之前的选择项.
- `⌥` + **轻按** (*Force Touch*: **单击**) 标注: 显示菜单, 包含当前位置**所有层级下**层叠的*区域标注*, 选择一项以选择标注, 同时保留之前的选择项.
- **右键轻按** (*Force Touch*: **双指单击**) 标注: 删除当前位置下的*坐标和颜色标注*, 或位于顶层的*区域标注*.
- `⌥` + **右键轻按** (*Force Touch*: **双指单击**) 标注: 显示菜单, 包含当前位置**所有层级下**层叠的*区域标注*, 选择一项以删除标注.
- **拖动** (*Force Touch*: **按下拖动**) 标注: 修改*坐标和颜色标注*到新的位置, 修改*区域标注*的尺寸.
- **按住** `⌃`: 暂时切换到 *魔术光标*.

### 放大镜
- **轻按** (*Force Touch*: **单击**): 自当前位置放大到下一缩放级别.
- `⇧` + **拖动** (*Force Touch*: **按下拖动**): 放大已拖拽区域, 使之填充整个窗口.
- **按住** `⌃`: 暂时切换到 *魔术光标*.
- **按住** `⌥`: 暂时切换到 *缩小镜*.

### 缩小镜
- **轻按** (*Force Touch*: **单击**): 自当前位置缩小到上一缩放级别.
- **按住** `⌃`: 暂时切换到 *魔术光标*.
- **按住** `⌥`: 暂时切换到 *放大镜*.

### 移动工具
- **拖动** (*Force Touch*: **按下拖动**) 视图: 常规鼠标设备的简单拖拽移动操作.
- **按住** `⌃`: 暂时切换到 *魔术光标*.

### 通用操作与快捷键
- **单指划动**: 妙控鼠标的视图移动操作.
- **双指划动**: 妙控板的视图移动操作.
- **双指捏合**: 妙控板放大或缩小视图.
- **单指双击**: 妙控鼠标智能缩放.
- **双指双击**: 妙控板智能缩放.
- `⌘` + `↑ ↓ ← →`: 将光标移动 1 个像素.
- `⇧⌘` + `↑ ↓ ← →`: 将光标移动 10 个像素.
- `⌃⌘` + `↑ ↓ ← →`: 将光标移动 100 个像素.
- `⌘-`: 以当前光标位置**缩小**视图 (如果光标位于视图外, 则以中心点位置缩小视图).
- `⌘=`: 以当前光标位置**放大**视图 (如果光标位于视图外, 则以中心点位置放大视图).
- `⌘[`: 如果已选中的*标注*是当前光标位置下所有层级中唯一选中的*标注*, 则切换选中状态到当前光标位置下层叠的前一个*标注*.
- `⌘]`: 如果已选中的*标注*是当前光标位置下所有层级中唯一选中的*标注*, 则切换选中状态到当前光标位置下层叠的后一个*标注*.

### 标尺
- **拖动**: 修改*坐标和颜色标注*到新的位置, 修改*区域标注*的尺寸.

### 适合窗口 / 填充窗口
缩放视图到适合/填充窗口的尺寸.

### 标注管理
- 从左侧的标注列表中选择一个或多个项.
- 右键单击以显示所选项的菜单:
  * `↵`: 将场景滚动定位到所选项, 并调整缩放比例以适配其尺寸.
  * `⌘C`: 使用当前*模板*复制所选项.
  * `⌘V`: 将来自其他文档的项粘贴到该文档中.
  * `⌘T`: 使用 Canny 边缘检测算法对选中区域进行智能裁切.
  * `⌥⌘E`: 使用当前*模板*导出所选项.
  * `⌥⌘R`: 重新采样: 将所选*区域标注*另存为 PNG 文件.
  * `⌘A`: 选中所有项.
  * `⌫`: 删除所选项.
- `0123456789`: 快速输入项 `ID` 以选择现有项.
- 在左下角的输入框中输入如下格式的数据, 并键入回车, 可以添加/定位项. 右键单击 `+` 以切换数据录入的格式.
  * 颜色与坐标: `(x, y)`
  * 区域: `(x1, y1, x2, y2)`
  * 区域: `(x, y, w, h)`

### 其他
- <code>⌘`</code>: 使用当前*模板*拷贝当前位置下的*坐标和颜色*到系统剪贴板.


## 菜单快捷键

### JSTColorPicker
- `⌘,` 偏好设置...
- `⌘H` 隐藏 JSTColorPicker
- `⌥⌘H` 隐藏其他窗口
- `⌘Q` 退出 JSTColorPicker

### 文件
- `⌘N` 新建
- `⌘O` 打开...
- `⌘W` 关闭
- `⌘S` 存储
- `⇧⌘S` 另存为...
- `⇧⌘D` 比较打开的文档
- `⇧⌘C`: 使用当前*模板*复制所有项.
- `⇧⌘E`: 使用当前*模板*导出所有项.

### 编辑
- `⌘Z` 撤销
- `⇧⌘Z` 重做
- `⌘C` 拷贝: 以当前模版拷贝选中项.
- `⌘V` 粘贴: 粘贴来自另一个文档中的项.
- `⌘T` 智能裁切: 以 Canny 边缘检测算法裁切选中区域.
- `⌥⌘E` 导出为: 以当前模版导出选中项.
- `⌥⌘R` 重新采样: 将选中区域另存为 PNG 文件.
- `⌘A` 全选
- `⌫` 删除

### 视图
- `⌥⌘T` 显示/隐藏工具栏
- `⌃⌘S` 显示/隐藏侧边栏
- `⌃⌘F` 进入/退出全屏幕
- `⌃⌘G` **切换颜色网格**
- `⌃⌘C` **切换颜色面板**

### 设备
- `⌃S` **截图**
- `⌃I` **立即寻找设备**

### 模版
- `⌃⌘` + `123456789`: 快速切换当前*模版*.
- `⌃⌘0` *重新加载所有模板*: 修改模板文件后, 使用该操作以重载所有*模板*文件, 立即生效.
- `⌃⌘F` *显示模板...*: 在 Finder 中显示*模板*存放的文件夹.
- `⌃⌘L` *显示日志...*: 打开*控制台*, 以便显示*模板*执行过程中产生的所有日志以及异常信息.

### 窗口
- `⌘M` 最小化
- `⌃⇧⇥` 显示上一个标签页
- `⌃⇥` 显示下一个标签页
- `⇧⌘\` 显示所有标签页

### 帮助
- `⌘?` JSTColorPicker 帮助


## 工具栏快捷键
- `[Fn]F1` 打开...
- `[Fn]F2` *魔术光标*
- `[Fn]F3` *放大镜*
- `[Fn]F4` *缩小镜*
- `[Fn]F5` *选择箭头*
- `[Fn]F6` *移动*
- `[Fn]F7` 适合窗口
- `[Fn]F8` 填充窗口


## 自定义模板

JSTColorPicker 使用 [Lua 5.3.4](https://www.lua.org/) 作为其模板引擎.

单击窗口右下方的*导出选项*按钮, 你将能查看并选择全部可用*模板*. 单击 `显示模板...` 将在 Finder 中打开默认*模板*文件夹 `templates`. 模板文件的文件名应以扩展名 `.lua` 结尾. 如果可能, 所选*模板*将应用于所有复制及导出操作.

### 编写自定义模板

*模板*是一个 *Lua* 脚本文件, 它仅返回一个表:
```lua
return {
  uuid = "0C2E7537-45A6-43AD-82A6-35D774414A09",  -- 必填, 唯一的 UUID4 标识符
  name = "Example",                               -- 必填, 仅供显示的模板名称
  version = "0.1",                                -- 必填, 同一模板的较早版本将被隐藏
  platformVersion = "1.6",                        -- 模板所需的最低软件版本
  author = "Lessica",                             -- 此模版作者的名称
  description = "This is an example of JSTColorPicker export script.",  -- 模板描述
  extension = "lua",                              -- 导出时所使用的文件扩展名
  generator = generator,                          -- 必填, 生成器回调函数
}
```

`generator` 生成器是一个 Lua 函数, 它将在你复制及导出项时被执行:
```lua
local generator = function (image, ...)
  --
  local args = {...}
  --
end
```

上述 `image` 是一个 Lua 表, 它代表当前窗口中打开的图像文档:
  - `image.path`: 图像文档路径
  - `image.filename`: 图像文件名称
  - `image.width`: 以像素为单位的图像宽度
  - `image.height`: 以像素为单位的图像高度
  - `image.get_color(x, y)`: 返回该位置颜色的 **argb** 32位整数值
  - `image.get_image(x, y, w, h)`: 返回以该区域裁切原始图像后, 生成子图像的 PNG 图像数据表示形式

上述 `args` 是一个包含若干表的 Lua 序列, 它包含了所有的*坐标和颜色标注*及*区域标注*信息:

* 如果是*坐标和颜色标注*, 则表中应包含如下字段:
  - `color.id`: 标注序号
  - `color.name`: 标注的第一个标签
  - `color.tags`: 标注的标签集合
  - `color.similarity`: 标注的相似度
  - `color.x`: 标注的 x 坐标
  - `color.y`: 标注的 y 坐标
  - `color.color`: 颜色的 **argb** 32位整数值

* 如果是*区域标注*, 则表中应包含如下字段:
  - `area.id`: 标注序号
  - `area.name`: 标注的第一个标签
  - `area.tags`: 标注的标签集合
  - `area.similarity`: 标注的相似度
  - `area.minX`: 标注的左上角 x 坐标
  - `area.minY`: 标注的左上角 y 坐标
  - `area.maxX`: 标注的右下角 x 坐标
  - `area.maxY`: 标注的右下角 y 坐标
  - `area.width`: 以像素为单位的区域宽度
  - `area.height`: 以像素为单位的区域高度

通过检查 `item.width` 字段是否存在即可判断当前表是一个*坐标和颜色标注*还是*区域标注*.

